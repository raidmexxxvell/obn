<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Football League</title>
    <!-- ИСПРАВЛЕНО: Убраны лишние пробелы в URL Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/splash.css">
</head>
<body data-admin="{{ admin_user_id }}">
    <!-- ЗАСТАВКА -->
    <div id="splash">
        <img src="/static/img/logo_liga.png" alt="Логотип" class="splash-logo-img">
        <div class="splash-text">Футбольная лига Обнинска</div>
        <div class="splash-loading-label">Идет загрузка...</div>
        <div class="loading-bar">
            <div class="loading-progress" id="loading-progress"></div>
        </div>
    </div>

    <!-- ОСНОВНОЕ ПРИЛОЖЕНИЕ -->
    <!-- Скрываем по умолчанию (чтобы не было мигания) -->
    <div class="container" id="app-content" style="display:none;">
        <div class="top-bar">
            <div class="league-title">Лига Обнинска</div>
            <img class="league-logo" src="/static/img/logo.png" alt="Логотип лиги">
        </div>
        <div id="tab-profile">
        <div class="profile-header">
            <div class="profile-avatar" id="user-avatar">
                <img src="" alt="Аватар">
            </div>
            <div class="profile-info">
                <h2 id="user-name">Загрузка...</h2>
                <div class="edit-name" id="edit-name">✎</div>
                <div class="favorite-team-row" style="margin-top:6px; display:flex; gap:8px; align-items:center;">
                    <label for="favorite-team" style="font-size:12px; color:var(--gray);">Любимый клуб:</label>
                    <select id="favorite-team" style="flex:1; max-width:220px;"><option value="">— выбрать —</option></select>
                </div>
            </div>
        </div>

        <div class="profile-stats">
            <div class="stat-card">
                <div class="stat-value" id="credits">0</div>
                <div class="stat-label">Кредиты</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="level">1</div>
                <div class="stat-label">Уровень</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="xp">0/100</div>
                <div class="stat-label">Опыт</div>
            </div>
        </div>

        <div class="xp-section">
            <div class="level-info">
                <span>Уровень <span id="current-level">1</span></span>
                <span><span id="current-xp">0</span>/<span id="xp-needed">100</span> XP</span>
            </div>
            <div class="xp-progress-container">
                <div class="xp-progress" id="xp-progress"></div>
            </div>
        </div>

        <div class="checkin-section">
            <div class="checkin-title">
                <span>Ежедневные награды</span>
                <span id="streak-days">День <span id="current-streak">1</span></span>
            </div>
            <div class="checkin-days" id="checkin-days">
                <!-- Дни цикла будут сгенерированы JS -->
            </div>
            <button class="checkin-button" id="checkin-btn">Получить награду</button>
            <div class="checkin-status" id="checkin-status"></div>
        </div>

    <div class="achievements-section">
            <div class="subtabs" id="profile-subtabs">
                <div class="subtab-item active" data-psub="badges">Достижения</div>
                <div class="subtab-item" data-psub="ref">Реферальная ссылка</div>
            </div>
            <div id="profile-pane-badges" class="profile-pane">
            <div class="achievements-container" id="badges">
                <!-- Достижение будет загружено через API -->
                <div class="achievement-card locked" id="achievement-placeholder">
                    <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MCIgaGVpZ2h0PSI2MCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLXRyb2Z5Ij48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIvPjxwb2x5bGluZSBwb2ludHM9IjEyIDYgMTYgMTQgMTIgMTAgOCAxNCAxMiA2Ii8+PC9zdmc+" alt="Достижение">
                    <div class="badge-name">Бронза</div>
                    <div class="badge-requirements">7 дней подряд</div>
                </div>
            </div>
            </div>
            
            <div id="profile-pane-ref" class="profile-pane" style="display:none;">
                <div class="referral-box wide full">
                    <div class="ref-link" id="referral-link">—</div>
                    <button class="checkin-button" id="copy-ref">Скопировать ссылку</button>
                    <div class="ref-stats">Приглашено: <span id="ref-count">0</span></div>
                </div>
            </div>
        </div>
        </div>

        <!-- Вкладка НЛО -->
    <div id="tab-ufo" style="display:none;">
            <!-- Подвкладки основной лиги НЛО -->
            <div class="subtabs" id="ufo-subtabs" style="display:none;">
                <div class="subtab-item active" data-subtab="table">Таблица</div>
                <div class="subtab-item" data-subtab="stats">Статистика</div>
                <div class="subtab-item" data-subtab="schedule">Расписание</div>
                <div class="subtab-item" data-subtab="results">Результаты</div>
            </div>
            <div class="ufo-content" id="ufo-content" style="display:none;">
                <div id="ufo-table" class="ufo-pane">
                    <div class="league-table-wrap">
                        <table class="league-table" id="league-table">
                            <tbody>
                                <!-- 10 строк будут заполнены через JS -->
                            </tbody>
                        </table>
                        <div class="table-updated" id="league-table-updated">
                            <span id="league-updated-text"></span>
                            {% if admin_user_id %}
                            <button class="refresh-btn" id="league-refresh-btn" style="display:none;">Обновить</button>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div id="ufo-stats" class="ufo-pane" style="display:none;">
                    <div class="league-table-wrap">
                        <table class="league-table" id="stats-table">
                            <tbody>
                                <!-- 11 строк будут заполнены через JS -->
                            </tbody>
                        </table>
                        <div class="table-updated" id="stats-table-updated"></div>
                    </div>
                </div>
                <div id="ufo-schedule" class="ufo-pane" style="display:none;">Здесь будет Расписание.</div>
                <div id="ufo-results" class="ufo-pane" style="display:none;">Здесь будут Результаты.</div>
                <!-- Детальный экран матча (вместо модалки) -->
                <div id="ufo-match-details" class="ufo-pane" style="display:none;">
                    <div class="match-details-topbar">
                        <button id="match-back" class="back-btn">← Назад</button>
                        <div class="md-title">Детали матча</div>
                    </div>
                    <div class="match-modal-header">
                        <div class="team side home">
                            <img class="logo" id="md-home-logo" alt="">
                            <div class="name" id="md-home-name"></div>
                        </div>
                        <div class="center">
                            <div class="score" id="md-score">— : —</div>
                            <div class="datetime" id="md-datetime"></div>
                        </div>
                        <div class="team side away">
                            <img class="logo" id="md-away-logo" alt="">
                            <div class="name" id="md-away-name"></div>
                        </div>
                    </div>
                    <div class="subtabs modal-subtabs">
                        <div class="subtab-item active" data-mdtab="home">Команда 1</div>
                        <div class="subtab-item" data-mdtab="away">Команда 2</div>
                    </div>
                    <div class="modal-body">
                        <div id="md-pane-home" class="md-pane"></div>
                        <div id="md-pane-away" class="md-pane" style="display:none;"></div>
                    </div>
                </div>
            </div>

            <!-- Блок БЛБ: пустые подвкладки -->
            <div id="blb-block" style="display:none;">
                <div class="subtabs" id="blb-subtabs">
                    <div class="subtab-item active" data-blbtab="table">Таблица</div>
                    <div class="subtab-item" data-blbtab="stats">Статистика</div>
                    <div class="subtab-item" data-blbtab="schedule">Расписание</div>
                    <div class="subtab-item" data-blbtab="results">Результаты</div>
                </div>
                <div class="ufo-content" id="blb-content">
                    <div id="blb-table" class="ufo-pane">Скоро...</div>
                    <div id="blb-stats" class="ufo-pane" style="display:none;">Скоро...</div>
                    <div id="blb-schedule" class="ufo-pane" style="display:none;">Скоро...</div>
                    <div id="blb-results" class="ufo-pane" style="display:none;">Скоро...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Нижняя навигация -->
    <nav class="nav">
        <div class="nav-item" data-tab="ufo">
            <div class="nav-icon">🛸</div>
            <div class="nav-label">НЛО</div>
        </div>
        <div class="nav-item" data-tab="predictions">
            <div class="nav-icon">📈</div>
            <div class="nav-label">Прогнозы</div>
        </div>
        <div class="nav-item" data-tab="leaderboard">
            <div class="nav-icon">🏆</div>
            <div class="nav-label">Лидерборд</div>
        </div>
        <div class="nav-item" data-tab="shop">
            <div class="nav-icon">🛒</div>
            <div class="nav-label">Магазин</div>
        </div>
        {% if admin_user_id %}
        <div class="nav-item" data-tab="admin" id="nav-admin" style="display:none;">
            <div class="nav-icon">🛠️</div>
            <div class="nav-label">Админ</div>
        </div>
        {% endif %}
        <div class="nav-item active" data-tab="profile">
            <div class="nav-icon">👤</div>
            <div class="nav-label">Профиль</div>
        </div>
    </nav>

    <!-- Оверлей выбора лиг над нижним меню -->
    <div id="league-overlay" style="display:none; position: fixed; left: 50%; transform: translateX(-50%); bottom: 72px; width: min(300px, calc(100% - 24px)); z-index: 1100;">
        <div class="league-list" style="display: grid; gap: 8px;">
            <div class="league-card" data-league="UFO" style="display:flex; align-items:center; gap:10px; padding:10px; border:1px solid rgba(255,255,255,0.1); border-radius:10px; cursor:pointer; background: rgba(10,18,40,0.96);">
                <div class="league-ico" style="font-size:20px;">🛸</div>
                <div class="league-name" style="font-weight:600;">НЛО — Лига Обнинска</div>
            </div>
            <div class="league-card" data-league="BLB" style="display:flex; align-items:center; gap:10px; padding:10px; border:1px solid rgba(255,255,255,0.1); border-radius:10px; cursor:pointer; background: rgba(10,18,40,0.96);">
                <div class="league-ico" style="font-size:20px;">🅱️</div>
                <div class="league-name" style="font-weight:600;">БЛБ — другая лига</div>
            </div>
        </div>
    </div>

    <!-- Экраны-заглушки для новых вкладок -->
    <div id="tab-predictions" style="display:none;">
        <div class="predictions-wrap">
            <div class="subtabs" id="pred-subtabs">
                <div class="subtab-item active" data-ptab="place">Сделать прогноз</div>
                <div class="subtab-item" data-ptab="mybets">Мои ставки</div>
            </div>
            <div id="pred-pane-place" class="pred-pane">
                <div class="pred-tours" id="pred-tours">Загрузка матчей...</div>
            </div>
            <div id="pred-pane-mybets" class="pred-pane" style="display:none;">
                <div class="my-bets" id="my-bets">Загрузка...</div>
            </div>
        </div>
    </div>
    <div id="tab-leaderboard" style="display:none;">
        <div class="leaderboard-wrap">
            <div class="subtabs" id="leader-subtabs">
                <div class="subtab-item active" data-ltab="predictors">Топ прогнозистов</div>
                <div class="subtab-item" data-ltab="rich">Топ богачей</div>
                <div class="subtab-item" data-ltab="server">Лидеры сервера</div>
                <div class="subtab-item" data-ltab="prizes">Призы</div>
            </div>
            <div id="leader-week-badge" class="leader-week-badge" style="text-align:center; color: var(--gray); font-size: 12px; margin: 4px 0 0;">Неделя: —</div>
            <div id="leader-pane-predictors" class="leader-pane">
                <div class="league-table-wrap">
                    <table class="league-table" id="lb-predictors">
                        <thead>
                            <tr><th>#</th><th>Имя</th><th>Ставок</th><th>Выигрышей</th><th>Win%</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <div class="table-updated" id="lb-predictors-updated"></div>
                </div>
            </div>
            <div id="leader-pane-rich" class="leader-pane" style="display:none;">
                <div class="league-table-wrap">
                    <table class="league-table" id="lb-rich">
                        <thead>
                            <tr><th>#</th><th>Имя</th><th>Прирост</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <div class="table-updated" id="lb-rich-updated"></div>
                </div>
            </div>
            <div id="leader-pane-server" class="leader-pane" style="display:none;">
                <div class="league-table-wrap">
                    <table class="league-table" id="lb-server">
                        <thead>
                            <tr><th>#</th><th>Имя</th><th>Уровень</th><th>XP</th><th>Серия</th><th>Скор</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <div class="table-updated" id="lb-server-updated"></div>
                </div>
            </div>
            <div id="leader-pane-prizes" class="leader-pane" style="display:none;">
                <div class="prizes-wrap" id="lb-prizes">
                    <!-- Здесь будут пьедесталы трех категорий -->
                </div>
                <div class="table-updated" id="lb-prizes-updated"></div>
            </div>
        </div>
    </div>

    {% if admin_user_id %}
    <!-- Вкладка Админ (только владелец; показывается через JS при совпадении ID) -->
    <div id="tab-admin" style="display:none;">
        <div class="predictions-wrap">
            <div class="subtabs">
                <div class="subtab-item active">Сервис</div>
            </div>
            <div class="pred-pane">
                <div class="store-grid" style="grid-template-columns: repeat(2, minmax(0,1fr));">
                    <div class="store-item">
                        <div class="store-name">Обновить все таблицы</div>
                        <div class="store-price" style="opacity:.8">Лига, статистика, расписание, результаты</div>
                        <button class="details-btn" id="admin-refresh-all">Обновить</button>
                    </div>
                    <div class="store-item">
                        <div class="store-name">Статистика онлайн</div>
                        <div class="store-price" id="admin-users-stats">—</div>
                        <button class="details-btn" id="admin-users-refresh">Обновить</button>
                    </div>
                    <div class="store-item">
                        <div class="store-name">Синхронизация</div>
                        <div class="store-price" id="admin-sync-summary">—</div>
                        <button class="details-btn" id="admin-sync-refresh">Показать</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Вкладка Магазин -->
    <div id="tab-shop" style="display:none;">
        <div class="predictions-wrap">
            <div class="subtabs" id="shop-subtabs">
                <div class="subtab-item active" data-stab="store">Магазин</div>
                <div class="subtab-item" data-stab="cart">Корзина</div>
            </div>
            <div id="shop-pane-store" class="pred-pane">
                <div class="store-grid">
                    <div class="store-item" data-id="stickerpack" data-name="Стикерпак" data-price="500">
                        <div class="store-img"></div>
                        <div class="store-name">Стикерпак</div>
                        <div class="store-price">500 кредитов</div>
                        <button class="details-btn">В корзину</button>
                    </div>
                    <div class="store-item" data-id="tshirt" data-name="Футболка" data-price="5000">
                        <div class="store-img"></div>
                        <div class="store-name">Футболка</div>
                        <div class="store-price">5 000 кредитов</div>
                        <button class="details-btn">В корзину</button>
                    </div>
                    <div class="store-item" data-id="badge_pro" data-name="Бейдж PRO" data-price="2500">
                        <div class="store-img"></div>
                        <div class="store-name">Бейдж PRO</div>
                        <div class="store-price">2 500 кредитов</div>
                        <button class="details-btn">В корзину</button>
                    </div>
                    <div class="store-item" data-id="vip_role" data-name="VIP-роль" data-price="10000">
                        <div class="store-img"></div>
                        <div class="store-name">VIP-роль</div>
                        <div class="store-price">10 000 кредитов</div>
                        <button class="details-btn">В корзину</button>
                    </div>
                </div>
            </div>
            <div id="shop-pane-cart" class="pred-pane" style="display:none;">
                <div style="padding:12px; color: var(--gray);">Корзина пуста.</div>
            </div>
        </div>
    </div>

    <script src="/static/js/splash.js"></script>
    <script src="/static/js/profile.js"></script>
    <script src="/static/js/predictions.js"></script>

    <!-- Удалено модальное окно: теперь детальный экран встроен как ufo-pane -->
</body>
</html>